# 시각적 회귀 테스트

## 시각적 회귀 테스트의 필요성

### 스타일 변경 검증의 어려움
- CSS는 상속과 중첩 구조로 인해 의도하지않은 수정 발생.
- 명시도, 적용 순서, 전역 스타일 등의 영향을 받으므로 결과예측의 어려움.
- 컴포넌트 기반 개발에서는 하나의 컴포넌트를 여러 화면에서 사용하므로 수정 시 영향 범위가 넓었음.

### 스냅샷 테스트의 한계
- HTML 출력 결과만 비교하므로 CSS Modules로 정의된 내용을 정확히 파악하지 못했음.
- 전역 스타일이 미치는 영향을 검출하는 데 한계가 있었음.

---

## 시각적 회귀 테스트의 방법

### 헤드리스 브라우저 활용
- 실제 브라우저에 렌더링된 화면을 비교하는 방식이 가장 신뢰도가 높았음.
- 헤드리스 브라우저를 사용하여 화면을 캡처하고, 스타일 변경 전후의 이미지를 픽셀 단위로 비교했음.
- 헤드리스 브라우저는 GUI 없이 명령어 기반으로 동작하며, HTML 렌더링과 JavaScript 실행이 가능했음.

#### 헤드리스 브라우저란?

- **GUI 없이 명령어 기반으로 동작하는 웹 브라우저**로, 일반적인 브라우저처럼 HTML을 렌더링하고 JavaScript를 실행하며 네트워크 요청을 처리할 수 있음.
- **UI 렌더링이 없어서 일반 브라우저보다 대체로 빠른 편**이며, 자동화에 최적화되어 테스트, 웹 스크래핑 등에 사용됨.
- **Playwright, Cypress, Puppeteer** 등 다양한 도구에서 지원됨.

---

## Storycap & reg-suit

### Storycap 주요 기능
- **스토리 캡처**: Storybook에 등록된 스토리를 자동으로 캡처하여 화면을 이미지 파일로 저장함.
- **이미지 저장** : 캡처된 이미지는 프로젝트 내의 screenshots 디렉터리에 저장되며, 이를 통해 스토리북의 시각적 변화를 쉽게 추적할 수 있음.
- **스토리북과 연동**: Storycap은 Storybook과의 연동을 통해 다양한 UI 상태를 캡처할 수 있음

### reg-suit 주요 기능
- **이미지 비교**: 커밋 해시 기반으로 기존 이미지와 새로운 이미지를 비교하여 차이점을 리포트로 출력.
- **클라우드 스토리지 통합**: AWS S3와 같은 클라우드 서비스에 이미지 저장 및 관리 가능함.
- **CI/CD 통합**: GitHub Actions 등 다양한 CI/CD 도구와 연동 가능했음.



---

## 시각적 회귀 테스트 활용 사례

1. **반응형 디자인 검증**: 다양한 화면 크기에서 디자인 실수를 줄이는 데 활용가능.  
2. **릴리스 직전 리팩터링**: 전역 CSS로 인해 발생할 수 있는 영향을 사전에 파악 가능했음.  

---

## 느낀점

이전에 팀에서 시각적 회귀 테스트를 도입했을 때,

장점으로는
- 팀 전체가 UI 변경 사항에 대해 명확한 시각적 피드백을 공유할 수 있었음.

단점으로는

- 복잡한 동적 콘텐츠에 대한 테스트가 어려운 점이 있었음.
- 세팅 및 관리에 필요한 리소스 소모가 꽤 컸음.

라고 생각했었다.
아쉽게도 책을 읽은 후에도 이러한 점들에 대한 생각이 크게 달라지지 않았다.
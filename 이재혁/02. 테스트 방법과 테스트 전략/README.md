# 02. 테스트 방법과 테스트 전략

## 1. 테스트 범위와 목적

테스트 코드 작성의 범위와 목적을 이해해야 시나리오를 작성하고 적절한 설계를 할 수 있다.

해당 장은 완독 후 정리본이라 하니 간단하게 작성한다.

### 1-1. 테스트 범위

한 가지의 기능은 아래와 같은 많은 모듈이 조합되어 만들어진다.

- 정적분석

타입스크립트나 ESLint가 제공하는 기능을 활용한다.

- 단위 테스트

한 가지 모듈에 한정하여 해당 모듈이 제공하는 기능을 검증하는 테스트이다

- 통합 테스트

모듈 조합으로 제공되는 기능을 검증하는 테스트다.

- E2E 테스트

헤드리스 브라우저와 UI 자동화 도구를 결합하여 검증하는 테스트이다.

### 2-1. 테스트 목적

테스트 타입은 테스트 목적에 따라 분류된다.

- 기능 테스트(인터랙션 테스트)

개발된 기능에 문제가 없는지 검증하는 테스트다. 대부분 UI 컴포넌트 조작에서 이루진다.

- 비기능 테스트(접근성 테스트)

신체적, 정신적 특성에 따른 차이 없이 동등하게 제품을 사용할 수 있는지 검증하는 테스트이다. 흔히 보는 키워드인 웹접근성과 연관이 있다.

- 회귀 테스트

특정 시점을 기준으로 전후 차이를 비교하여 문제가 있는지 검증하는 테스트이다.

---

## 2. 프론트엔드 테스트의 범위

### 2-1. 정적 분석

타입스크립트에서 타입 추론을 통해 런타임 작동을 예측해 준다. 반환 타입 추론으로도 안정성에 기여한다.

ESLint를 통해 코드를 작성하는 시점에 범할 법한 경고나 에러를 표기해 준다.

### 2-2. 단위 테스트

동일한 인풋에 대해 동일한 아웃풋이 나와야 하는 순수 함수가 단위 테스트를 하기에 적합하다.

예외 처리에도 유용하다

### 2-3. 통합 테스트

여러 모듈을 연동한 테스트이다.

인터랙션을 시작으로 발생하는 흐름을 테스트 한다.

인터랙션 → 상태 변화 → API 호출 → 화면 갱신

### 2-4. E2E 테스트

UI 테스트 뿐만 아니라 외부 스토리지와 같이 연동 중인 하위 시스템을 포함하는 테스트이다.

---

## 3. 프론트엔드 테스트의 목적

### 3-1 기능 테스트(인터랙션 테스트)

유저의 액션과 연관된 인터랙션을 기반으로 이루어지는 테스트이다.

기본적으로 UI 단에서 인터랙션을 통해 상태가 변하고 이에 따른 리렌더링으로 화면을 갱신하는 플로우를 타게된다.

실제 브라우저 없이 요소의 속성 값을 통해 테스트가 가능하다.

- 버튼 클릭 → 콜백 함수 호출 (click event)
- 문자 입력 → 버튼 활성화 (change event)
- 로그아웃 버튼 클릭 → 로그인 화면으로 이동 (click event + route change)

반대로 브라우저가 있어야만 테스트 가능한 경우가 있다.

- 스크롤 기반의 이벤트 동작
- 스토리지 접근을 통한 동작

### 3-2. 비기능 테스트(접근성 테스트)

접근성 테스트는 비기능 테스트 중 하나이다.

- 키보드만으로 웹사이트 이용이 가능한가 (tabIndex)
- [명암비 체크](https://webaim.org/resources/contrastchecker/)

### 3-3. 시각적 회귀 테스트

시각적 회귀 테스트는 회귀 테스트 중 하나이다.

실제 적용된 CSS의 올바른 동작 검증을 위해 테스트한다.

캡쳐된 이미지 간의 비교, 유저의 액션을 통해 변경된 화면까지 비교한다.

---

## 4. 테스트 전략 모델

유저의 실제 환경에 기반한 테스트 일수록 신뢰도는 높아지지만 시간과 비용이 많이 든다.

테스트 분배에 따른 전략은 논의를 잘해야 한다.

그래서 유저의 실제 환경에 가까운 테스트들은 크리티컬한 문제가 발생하면 안되는 등 진짜 중요한 플로우에만 일부 적용한다고 어디선가 주워들었다

e.g. ) 결제, 주식 매매

![image.png](attachment:8465c280-bbe2-40ca-ab37-55f4f4276f10:image.png)

### 4-1. 아이스크림 콘과 테스트 피라미드

아이스크림 콘 모델은 안티패턴으로 많이 불리운다.

높은 운용 비용 / 모듈 간의 강한 의존성 때문에 발생하는 많은 실패 케이스가 생긴다.

또한 테스트 통과에 소요되는 시간이 많아서 개발 흐름에 나쁜 영향을 준다.

이 두 모델 간의 트레이드 오프는 존재한다…

테스트 피라미드가 높은 신속성, 이에 따른 안정성 확보 때문에 테스트 자동화에 있어서는 우수한 전략이라는 것이 지배적이다.

![image.png](attachment:e6c5d0a2-d2e2-4fe5-955c-e05533a97c3a:image.png)

### 4-2. 테스팅 트로피

핵심은 사용자 조작을 기반으로 한 통합 테스트의 비중이 가장 높아야 한다는 것이다.

유저 액션 기반의 테스트를 헤드리스 브라우저 없이도 구현이 가능하기 때문에 빠르면서도 실제 서비스와 유사한 테스트가 가능하다.

![image.png](attachment:40fd141d-3ec7-4e80-a226-a5bac12309c1:image.png)

---

## 5. 테스트 전략 계획

각 프로젝트의 최적의 전략 수립을 위해서는 여러 판단 기준이 필요하다.

### 5-1. 테스트가 없어 리팩토링이 불안한 경우

일단 릴리즈된 기능을 리스트로 정리 후 변경 전후로 결함이 발생하지 않았는지 회귀 테스트를 통해 검증한다.

웹 API와 깔끔하게 의존성 분리가 되지 않는다면 테스트 작성이 어려운데 MSW같은 목 서버를 활용해 통합 테스트를 작성할 수 있다.

### 5-2. 반응형으로 제작된 프로젝트

모든 디바이스, 화면에 따른 반응형 대응은 어려운 문제다.

스토리북을 통해 UI 컴포넌트 테스트가 가능하다

reg-suit를 통해 시각적 회귀 테스트가 가능하다.

### 5-3. 데이터베이스를 포함한 E2E 테스트가 필요한 경우

테스트용 스테이지 환경을 마련하여 최대한 프러덕션 환경과 동일하지만 바라보는 DB만 다르게 하여 테스트 한다. 그러면 QA에서 수동으로 테스트가 가능하다.

자동화하고 싶다면 도커를 통해 테스트가 가능하다. 아찔하다
